CREATE TABLE "AVAILABILITY"
   (	"BEER_ID" NUMBER,
    	"MAGAZINE_ID" NUMBER,
    	"QUANTITY" NUMBER
   );
 
  CREATE TABLE "AVAILABILITY_LOG"
   (	"LOG_OPERATION" CHAR(3 BYTE),
    	"LOG_ORACLE_USER" VARCHAR2(30 BYTE),
    	"LOG_DATETIME" DATE,
    	"LOG_APPLN" VARCHAR2(35 BYTE),
    	"LOG_SESSION" NUMBER,
    	"BEER_ID" NUMBER,
    	"MAGAZINE_ID" NUMBER,
    	"QUANTITY" NUMBER
   );
 
  CREATE TABLE "BEER"
   (	"BEER_ID" NUMBER(*,0),
    	"AMOUNT" NUMBER,
    	"NAME" VARCHAR2(20 BYTE),
    	"KIND" VARCHAR2(20 BYTE),
    	"AVAILABILITY" VARCHAR2(20 BYTE),
    	"PRICE" FLOAT(126),
    	"BREWERY_ID" NUMBER,
    	"MAGAZINE_ID" NUMBER
   );
 
  CREATE TABLE "BREWERY"
   (	"BREWERY_ID" NUMBER(*,0),
    	"ADDRESS" VARCHAR2(100 BYTE),
    	"EMAIL" VARCHAR2(100 BYTE),
    	"PHONE_NUMBER" NUMBER(9,0)
   );
 
  CREATE TABLE "CLIENT"
   (	"CLIENT_ID" NUMBER,
    	"CLIENT_NAME" VARCHAR2(20 BYTE),
    	"CLIENT_SURNAME" VARCHAR2(20 BYTE),
    	"ADDRESS" VARCHAR2(100 BYTE),
    	"CONTACT_NUMB" NUMBER(9,0)
   );
 
 
  CREATE TABLE "EMPLOYEE"
   (	"EMPLOYEE_ID" NUMBER,
    	"EMPLOYEE_NAME" VARCHAR2(20 BYTE),
    	"EMPLOYEE_SURNAME" VARCHAR2(100 BYTE),
    	"POSITION" VARCHAR2(100 BYTE),
    	"EMPLOYEE_MAIL" VARCHAR2(100 BYTE),
    	"PHONE_NUMB" NUMBER(9,0),
    	"MAGAZINE_ID" NUMBER
   );
 
 
  CREATE TABLE "MAGAZINE"
   (	"MAGAZINE_ID" NUMBER(*,0),
    	"LOCALIZATION" VARCHAR2(100 BYTE),
    	"MANAGER" VARCHAR2(100 BYTE)
   );
  CREATE TABLE "ORDER"
   (	"ORDER_ID" NUMBER,
    	"AMOUNT" NUMBER,
    	"ORDER_DATE" DATE,
    	"STATUS" VARCHAR2(20 BYTE),
    	"DELIVERY_DATE" DATE,
    	"CLIENT_ID" NUMBER,
    	"BEER_ID" NUMBER,
    	"EMPLOYEE_ID" NUMBER
   );
 
Insert into AVAILABILITY (BEER_ID,MAGAZINE_ID,QUANTITY) values (2,1,3);
Insert into AVAILABILITY (BEER_ID,MAGAZINE_ID,QUANTITY) values (3,1,2);
Insert into AVAILABILITY (BEER_ID,MAGAZINE_ID,QUANTITY) values (4,1,1);
Insert into AVAILABILITY (BEER_ID,MAGAZINE_ID,QUANTITY) values (5,1,4);
Insert into AVAILABILITY (BEER_ID,MAGAZINE_ID,QUANTITY) values (1,1,3);
 
Insert into AVAILABILITY_LOG (LOG_OPERATION,LOG_ORACLE_USER,LOG_DATETIME,LOG_APPLN,LOG_SESSION,BEER_ID,MAGAZINE_ID,QUANTITY) values ('INS','PWR_17_18_L_016238896',to_date('01-06-18','DD-MM-RR'),'SQL Developer',1575231,1,1,5);
Insert into AVAILABILITY_LOG (LOG_OPERATION,LOG_ORACLE_USER,LOG_DATETIME,LOG_APPLN,LOG_SESSION,BEER_ID,MAGAZINE_ID,QUANTITY) values ('INS','PWR_17_18_L_016238896',to_date('02-06-18','DD-MM-RR'),'SQL Developer',1575231,2,1,3);
Insert into AVAILABILITY_LOG (LOG_OPERATION,LOG_ORACLE_USER,LOG_DATETIME,LOG_APPLN,LOG_SESSION,BEER_ID,MAGAZINE_ID,QUANTITY) values ('INS','PWR_17_18_L_016238896',to_date('02-06-18','DD-MM-RR'),'SQL Developer',1575231,3,1,2);
Insert into AVAILABILITY_LOG (LOG_OPERATION,LOG_ORACLE_USER,LOG_DATETIME,LOG_APPLN,LOG_SESSION,BEER_ID,MAGAZINE_ID,QUANTITY) values ('INS','PWR_17_18_L_016238896',to_date('02-06-18','DD-MM-RR'),'SQL Developer',1575231,4,1,1);
Insert into AVAILABILITY_LOG (LOG_OPERATION,LOG_ORACLE_USER,LOG_DATETIME,LOG_APPLN,LOG_SESSION,BEER_ID,MAGAZINE_ID,QUANTITY) values ('INS','PWR_17_18_L_016238896',to_date('03-06-18','DD-MM-RR'),'SQL Developer',1575231,5,1,4);
Insert into AVAILABILITY_LOG (LOG_OPERATION,LOG_ORACLE_USER,LOG_DATETIME,LOG_APPLN,LOG_SESSION,BEER_ID,MAGAZINE_ID,QUANTITY) values ('UPD','PWR_17_18_L_016238896',to_date('03-06-18','DD-MM-RR'),'SQL Developer',1575231,1,2,5);
Insert into AVAILABILITY_LOG (LOG_OPERATION,LOG_ORACLE_USER,LOG_DATETIME,LOG_APPLN,LOG_SESSION,BEER_ID,MAGAZINE_ID,QUANTITY) values ('DEL','PWR_17_18_L_016238896',to_date('03-06-18','DD-MM-RR'),'SQL Developer',1575231,1,2,5);
Insert into AVAILABILITY_LOG (LOG_OPERATION,LOG_ORACLE_USER,LOG_DATETIME,LOG_APPLN,LOG_SESSION,BEER_ID,MAGAZINE_ID,QUANTITY) values ('INS','PWR_17_18_L_016238896',to_date('07-06-18','DD-MM-RR'),'SQL Developer',1575231,1,1,3);


 
Insert into BEER (BEER_ID,AMOUNT,NAME,KIND,AVAILABILITY,PRICE,BREWERY_ID,MAGAZINE_ID) values (1,3,'Shake The World','Milkshake','YES',9,2,1);
Insert into BEER (BEER_ID,AMOUNT,NAME,KIND,AVAILABILITY,PRICE,BREWERY_ID,MAGAZINE_ID) values (2,4,'Paulaner','Hefeweizen','YES',5,2,1);
Insert into BEER (BEER_ID,AMOUNT,NAME,KIND,AVAILABILITY,PRICE,BREWERY_ID,MAGAZINE_ID) values (3,5,'Śmietanka Torunska','Hefeweizen','YES',7,1,1);
Insert into BEER (BEER_ID,AMOUNT,NAME,KIND,AVAILABILITY,PRICE,BREWERY_ID,MAGAZINE_ID) values (4,6,'Cornerlius Bananowy','Pszczeniczne','YES',3,3,1);
Insert into BEER (BEER_ID,AMOUNT,NAME,KIND,AVAILABILITY,PRICE,BREWERY_ID,MAGAZINE_ID) values (5,7,'Bavaria alkoholfrei','Witbier','YES',2,1,1);
 
 
 
Insert into BREWERY (BREWERY_ID,ADDRESS,EMAIL,PHONE_NUMBER) values (1,'ul. Pokoju','browarnasturcja@gmail.com',668154325);
Insert into BREWERY (BREWERY_ID,ADDRESS,EMAIL,PHONE_NUMBER) values (2,'ul. Toruńska','alepalebro@gmail.com',775775123);
Insert into BREWERY (BREWERY_ID,ADDRESS,EMAIL,PHONE_NUMBER) values (3,'ul. Unisławska','browartorusnki@torun.pl',554152325);
Insert into BREWERY (BREWERY_ID,ADDRESS,EMAIL,PHONE_NUMBER) values (4,'ul. Roberta','dobrepiwo@gmail.com',664789456);
Insert into BREWERY (BREWERY_ID,ADDRESS,EMAIL,PHONE_NUMBER) values (5,'ul. Św. Mateusza','pinta@pinta.pl',754556132);
 
 
Insert into CLIENT (CLIENT_ID,CLIENT_NAME,CLIENT_SURNAME,ADDRESS,CONTACT_NUMB) values (1,'Janusz','Kolanko','ul. Adroidowa',663663145);
Insert into CLIENT (CLIENT_ID,CLIENT_NAME,CLIENT_SURNAME,ADDRESS,CONTACT_NUMB) values (2,'Marta','Piwna','ul. Brzechwy',655415325);
Insert into CLIENT (CLIENT_ID,CLIENT_NAME,CLIENT_SURNAME,ADDRESS,CONTACT_NUMB) values (3,'Andrzej','Podhalny','ul. Cebulowa',888624325);
Insert into CLIENT (CLIENT_ID,CLIENT_NAME,CLIENT_SURNAME,ADDRESS,CONTACT_NUMB) values (4,'Krzysztof','Innyj','ul. Dobra',541145515);
Insert into CLIENT (CLIENT_ID,CLIENT_NAME,CLIENT_SURNAME,ADDRESS,CONTACT_NUMB) values (5,'Karol','Makłowicz','ul. Elizy Orzeszkowej',509832803);
 
 
Insert into EMPLOYEE (EMPLOYEE_ID,EMPLOYEE_NAME,EMPLOYEE_SURNAME,POSITION,EMPLOYEE_MAIL,PHONE_NUMB,MAGAZINE_ID) values (1,'Filip','Abramowicz','magazynier','filip.a@firma.pl',774227155,1);
Insert into EMPLOYEE (EMPLOYEE_ID,EMPLOYEE_NAME,EMPLOYEE_SURNAME,POSITION,EMPLOYEE_MAIL,PHONE_NUMB,MAGAZINE_ID) values (2,'Karol','Emilianowicz','magazynier','karol.e@firma.pl',546757567,2);
Insert into EMPLOYEE (EMPLOYEE_ID,EMPLOYEE_NAME,EMPLOYEE_SURNAME,POSITION,EMPLOYEE_MAIL,PHONE_NUMB,MAGAZINE_ID) values (3,'Robert','Zdunski','magazynier','robert.z@firma.pl',523123213,3);
Insert into EMPLOYEE (EMPLOYEE_ID,EMPLOYEE_NAME,EMPLOYEE_SURNAME,POSITION,EMPLOYEE_MAIL,PHONE_NUMB,MAGAZINE_ID) values (4,'Szymon','Adręcki','magazynier','szymon.a@firma.pl',665432134,4);
Insert into EMPLOYEE (EMPLOYEE_ID,EMPLOYEE_NAME,EMPLOYEE_SURNAME,POSITION,EMPLOYEE_MAIL,PHONE_NUMB,MAGAZINE_ID) values (5,'Paweł','Kolos','magazynier','pawel.k@firma.pl',788925153,5);
 
Insert into MAGAZINE (MAGAZINE_ID,LOCALIZATION,MANAGER) values (1,'Toruń','Marcin Kania');
Insert into MAGAZINE (MAGAZINE_ID,LOCALIZATION,MANAGER) values (2,'Warszawa','Juliusz Podłoga');
Insert into MAGAZINE (MAGAZINE_ID,LOCALIZATION,MANAGER) values (3,'Świnoujście','Krystian Kanapka');
Insert into MAGAZINE (MAGAZINE_ID,LOCALIZATION,MANAGER) values (4,'Gdańsk','Julia Boska');
Insert into MAGAZINE (MAGAZINE_ID,LOCALIZATION,MANAGER) values (5,'Wrocław','Andrzej Krasny');
 
Insert into "ORDER" (ORDER_ID,AMOUNT,ORDER_DATE,STATUS,DELIVERY_DATE,CLIENT_ID,BEER_ID,EMPLOYEE_ID) values (1,1,to_date('01-01-18','DD-MM-RR'),'DELIVERY',to_date('05-01-18','DD-MM-RR'),1,1,1);
Insert into "ORDER" (ORDER_ID,AMOUNT,ORDER_DATE,STATUS,DELIVERY_DATE,CLIENT_ID,BEER_ID,EMPLOYEE_ID) values (2,3,to_date('02-01-18','DD-MM-RR'),'DELIVERY',to_date('03-01-18','DD-MM-RR'),1,2,1);
Insert into "ORDER" (ORDER_ID,AMOUNT,ORDER_DATE,STATUS,DELIVERY_DATE,CLIENT_ID,BEER_ID,EMPLOYEE_ID) values (3,1,to_date('02-01-18','DD-MM-RR'),'DELIVERY',to_date('07-01-18','DD-MM-RR'),1,3,1);
Insert into "ORDER" (ORDER_ID,AMOUNT,ORDER_DATE,STATUS,DELIVERY_DATE,CLIENT_ID,BEER_ID,EMPLOYEE_ID) values (4,8,to_date('01-01-18','DD-MM-RR'),'DELIVERY',to_date('01-01-18','DD-MM-RR'),1,4,1);
Insert into "ORDER" (ORDER_ID,AMOUNT,ORDER_DATE,STATUS,DELIVERY_DATE,CLIENT_ID,BEER_ID,EMPLOYEE_ID) values (5,1,to_date('02-01-18','DD-MM-RR'),'DELIVERY',to_date('16-01-18','DD-MM-RR'),1,5,1);


 
 
  CREATE UNIQUE INDEX "BEER_PK" ON "BEER" ("BEER_ID");
 
  CREATE UNIQUE INDEX "BREWERY_PK" ON "BREWERY" ("BREWERY_ID");
 
  CREATE UNIQUE INDEX "CLIENT_PK" ON "CLIENT" ("CLIENT_ID");
 
  CREATE UNIQUE INDEX "EMPLOYEE_PK" ON "EMPLOYEE" ("EMPLOYEE_ID");
 
  CREATE UNIQUE INDEX "MAGAZINE_PK" ON "MAGAZINE" ("MAGAZINE_ID");
 
  CREATE UNIQUE INDEX "ORDER_PK" ON "ORDER" ("ORDER_ID");
 
 
  CREATE OR REPLACE TRIGGER "AVAILABILITY_LOG_TRIG"
  AFTER
  INSERT OR
  UPDATE OR
  DELETE ON AVAILABILITY for each row
 Declare
  rec AVAILABILITY_LOG%ROWTYPE;
  blank AVAILABILITY_LOG%ROWTYPE;
  BEGIN
	rec := blank;
	IF INSERTING OR UPDATING THEN
 	 rec.beer_id := :NEW.beer_id;
  	rec.magazine_id := :NEW.magazine_id;
  	rec.quantity := :NEW.quantity;
  	rec.LOG_DATETIME := SYSDATE;
  	rec.LOG_ORACLE_USER := SYS_CONTEXT ('USERENV', 'SESSION_USER');
  	rec.LOG_APPLN := SYS_CONTEXT ('USERENV', 'MODULE');
  	rec.LOG_SESSION := SYS_CONTEXT ('USERENV', 'SESSIONID');
  	IF INSERTING THEN
    	rec.LOG_OPERATION := 'INS';
  	ELSIF UPDATING THEN
    	rec.LOG_OPERATION := 'UPD';
  	END IF;
	ELSIF DELETING THEN
  	rec.beer_id := :OLD.beer_id;
  	rec.magazine_id := :OLD.magazine_id;
  	rec.quantity := :OLD.quantity;
  	rec.LOG_DATETIME := SYSDATE;
  	rec.LOG_ORACLE_USER := SYS_CONTEXT ('USERENV', 'SESSION_USER');
	  rec.LOG_APPLN := SYS_CONTEXT ('USERENV', 'MODULE');
  	rec.LOG_SESSION := SYS_CONTEXT ('USERENV', 'SESSIONID');
  	rec.LOG_OPERATION := 'DEL';
	END IF;
	INSERT into AVAILABILITY_LOG VALUES rec;
  END;
/
ALTER TRIGGER "AVAILABILITY_LOG_TRIG" ENABLE;
 
ALTER TABLE "AVAILABILITY_LOG" MODIFY ("LOG_OPERATION" NOT NULL ENABLE);
 
  ALTER TABLE "BEER" MODIFY ("BEER_ID" NOT NULL ENABLE);
  ALTER TABLE "BEER" ADD CONSTRAINT "BEER_PK" PRIMARY KEY ("BEER_ID");
 
 
  ALTER TABLE "BREWERY" MODIFY ("BREWERY_ID" NOT NULL ENABLE);
  ALTER TABLE "BREWERY" ADD CONSTRAINT "BREWERY_PK" PRIMARY KEY ("BREWERY_ID");
 
 
  ALTER TABLE "CLIENT" MODIFY ("CLIENT_ID" NOT NULL ENABLE);
  ALTER TABLE "CLIENT" ADD CONSTRAINT "CLIENT_PK" PRIMARY KEY ("CLIENT_ID");
 
 
  ALTER TABLE "EMPLOYEE" MODIFY ("EMPLOYEE_ID" NOT NULL ENABLE);
  ALTER TABLE "EMPLOYEE" ADD CONSTRAINT "EMPLOYEE_PK" PRIMARY KEY ("EMPLOYEE_ID");
 
  ALTER TABLE "MAGAZINE" MODIFY ("MAGAZINE_ID" NOT NULL ENABLE);
  ALTER TABLE "MAGAZINE" ADD CONSTRAINT "MAGAZINE_PK" PRIMARY KEY ("MAGAZINE_ID");
 
 
  ALTER TABLE "ORDER" MODIFY ("ORDER_ID" NOT NULL ENABLE);
  ALTER TABLE "ORDER" ADD CONSTRAINT "ORDER_PK" PRIMARY KEY ("ORDER_ID");
 
ALTER TABLE "ORDER"
ADD CONSTRAINT FK_EMPLOYEE
FOREIGN KEY (EMPLOYEE_ID) REFERENCES employee(employee_id);
 
ALTER TABLE "ORDER"
ADD CONSTRAINT FK_CLIENT
FOREIGN KEY (CLIENT_ID) REFERENCES CLIENT(CLIENT_ID);
 
ALTER TABLE "ORDER"
ADD CONSTRAINT FK_BEER
FOREIGN KEY (BEER_ID) REFERENCES BEER(BEER_ID);
 
ALTER TABLE "EMPLOYEE"
ADD CONSTRAINT FK_MAGAZ
FOREIGN KEY (MAGAZINE_ID) REFERENCES MAGAZINE(MAGAZINE_ID);
 
ALTER TABLE "AVAILABILITY"
ADD CONSTRAINT FK_AVABEER
FOREIGN KEY (BEER_ID) REFERENCES BEER(BEER_ID);
 
ALTER TABLE "AVAILABILITY"
ADD CONSTRAINT FK_AVAMAG
FOREIGN KEY (MAGAZINE_ID) REFERENCES MAGAZINE(MAGAZINE_ID);
 
ALTER TABLE "BEER"
ADD CONSTRAINT FK_BEERBREW
FOREIGN KEY (BREWERY_ID) REFERENCES BREWERY(BREWERY_ID);

 
CREATE or REPLACE VIEW "zamowienia" AS
  SELECT ORDER_ID, BEER_ID, NAME, KIND, PRICE, O.AMOUNT, CLIENT_NAME, CLIENT_SURNAME
  FROM "ORDER" O
JOIN "BEER" USING(BEER_ID)
JOIN "CLIENT" USING(CLIENT_ID);
